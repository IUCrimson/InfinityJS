!function(container){var InfinityJS=BBUI.ns("InfinityJS"),baseUrl,databaseName;container?(baseUrl=container.svc.baseUrl,databaseName=container.svc.databaseName):(baseUrl=BBUI.pages.ActionUtility.nav.baseUrl,databaseName=BBUI.pages.ActionUtility.nav.databaseName);var WebSvc=new BBUI.webshell.Service(baseUrl,databaseName),UiSvc=new BBUI.uimodeling.Service.fromSvc(WebSvc),DialogSvc=BBUI.pages.Dialogs;InfinityJS.NewPromise=function(){var e=$.Deferred();return e.resolvePromise=function(n,i){return i?e.reject(i.message):e.resolve(n)},e},InfinityJS.xhr=function(e,n,i){var t=$.Deferred();return i=i||{responseFormat:"JSON"},i.successCallback=function(e){t.resolved(e)},BBUI.xhr(e,n,i),t.promise()},InfinityJS.addCss=function(e){var n=[];InfinityJS.isValidUrl(e)?n.push(e):"["===e.substring(0,1)&&(n=JSON.parse(e)),n?$.each(n,function(e,n){$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href",n)}):$("<style rel='stylesheet' type='text/css'>").text(e).appendTo("head")},InfinityJS.addJs=function(js){var jsList=[];if(InfinityJS.isValidUrl(js)?jsList.push(js):"["===js.substring(0,1)&&(jsList=JSON.parse(js)),jsList){var q=new $.Deferred,pipe=q;$.each(jsList,function(e,n){pipe=pipe.pipe(function(){return $.getScript(n)})}),q.resolve()}else eval(js)},InfinityJS.findByProp=function(e,n,i){return $.grep(e,function(e){return e[n]==i})},InfinityJS.findByProps=function(e,n){var i=e;return $.each(n,function(e,n){i=InfinityJS.findByProp(i,n.name,n.value)}),i},InfinityJS.findOneByProp=function(e,n,i){return InfinityJS.findByProp(e,n,i)[0]},InfinityJS.getHostParameters=function(e){var n={};return e.parameters?($.each(e.parameters,function(e,i){n[i.name]=i.value}),n):n},InfinityJS.getFormValue=function(e,n){var i=e.createFormResult.formComponent.model.fields.filter(function(e){return e.name===n});return i&&i.length?i[0].value:null},InfinityJS.isValidEmailAddress=function(e){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(e)},InfinityJS.isValidUrl=function(e){if("."===e.substring(0,1))return!0;var n=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return n.test(e)},InfinityJS.formatMoney=function(e,n,i,t){var n=isNaN(n=Math.abs(n))?2:n,i=void 0==i?".":i,t=void 0==t?",":t,r=0>e?"-":"",a=parseInt(e=Math.abs(+e||0).toFixed(n))+"",o=(o=a.length)>3?o%3:0;return r+(o?a.substr(0,o)+t:"")+a.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+t)+(n?i+Math.abs(e-a).toFixed(n).slice(2):"")},InfinityJS.UI={},InfinityJS.UI.toast=function(e,n){BBUI.pages.Dialogs.notify(e,n,{position:"top-right",life:6e3})},InfinityJS.UI.beginWait=function(){BBUI.forms.Utility.beginWait()},InfinityJS.UI.endWait=function(){BBUI.forms.Utility.endWait()},InfinityJS.UI.confirm=function(e,n,i){BBUI.forms.Utility.confirm(e,{callback:function(e){1>=e?n():i()}})},InfinityJS.UI.mailTo=function(e,n,i){window.open("mailto:"+e+"?subject="+encodeURIComponent(n)+"&body="+encodeURIComponent(i))},InfinityJS.UI.refreshPage=function(){container.invokePageRefresh()},InfinityJS.UI.goToPage=function(e,n,i,t){container.invokePageNavigation({mode:3,destinationId:e,tabId:n,contextId:i,options:t})},InfinityJS.DataForm={},InfinityJS.DataForm.show=function(e,n){var i=InfinityJS.NewPromise();return n=n||{},n.confirmCallback=i.resolvePromise,n.cancelCallback=i.resolvePromise,n.returnDataFormItem=!0,DialogSvc.showDataForm(UiSvc,e,n),i.promise()},InfinityJS.DataForm.showAddForm=function(e,n){return InfinityJS.DataForm.show(e,{defaultValues:n})},InfinityJS.DataForm.showEditForm=function(e,n,i){return InfinityJS.DataForm.show(e,{recordId:n,defaultValues:i})},InfinityJS.DataForm.load=function(e,n){var i=InfinityJS.NewPromise(),t=function(e){var n={};$.each(e.values,function(){n[this.name]=this.value}),i.resolvePromise(n)};return WebSvc.dataFormLoad(e,t,i.resolvePromise,{recordId:n}),i.promise()},InfinityJS.DataForm.save=function(e,n,i){var t=InfinityJS.NewPromise(),r={recordId:n,values:i};return WebSvc.dataFormSave(e,t.resolvePromise,t.resolvePromise,r),t.promise()},InfinityJS.DataList={},InfinityJS.DataList.load=function(e,n,i){var t=InfinityJS.NewPromise();return i=i||{},i.returnFormattedValues=!0,WebSvc.dataListLoad(e,n,t.resolvePromise,t.resolvePromise,i),t.promise()},InfinityJS.DataList.getOutputDefinition=function(e,n){var i=InfinityJS.NewPromise();return WebSvc.dataListGetOutputDefinition(e,i.resolvePromise,i.resolvePromise,n),i.promise()},InfinityJS.DataList.loadAsObjects=function(e,n,i){var t=InfinityJS.NewPromise();return $.when(InfinityJS.DataList.load(e,n,i),InfinityJS.DataList.getOutputDefinition(e)).done(function(e,n){for(var i=e.rows,r=[],a=0,o=e.rowCount;o>a;a++){for(var s={},f=0,c=n.outputFields.length;c>f;f++){var u=n.outputFields[f],l=i[a].values[f];switch(u.dataType){case 1:case 2:case 3:case 15:l=parseInt(l);break;case 5:case 6:l=parseFloat(l);break;case 7:l="True"===l}s[u.fieldId]=l}r.push(s)}t.resolvePromise(r)}),t.promise()},InfinityJS.RecordOperation={},InfinityJS.RecordOperation["do"]=function(e,n,i){var t=InfinityJS.NewPromise();return WebSvc.recordOperationPerform(e,n,t.resolvePromise,t.resolvePromise,{parameters:i}),t.promise()},InfinityJS.RecordOperation.doWithConfirm=function(e,n,i){var t=InfinityJS.NewPromise();return WebSvc.recordOperationGetPrompt(e,n,function(r){InfinityJS.UI.confirm(r.promptText,function(){InfinityJS.RecordOperation["do"](e,n,i).then(t.resolvePromise)},t.resolvePromise)},t.resolvePromise),t.promise()}}();