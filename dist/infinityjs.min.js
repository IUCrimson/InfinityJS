!function(e){var r,o,t=BBUI.ns("InfinityJS");e?(r=e.svc.baseUrl,o=e.svc.databaseName):(r=BBUI.pages.ActionUtility.nav.baseUrl,o=BBUI.pages.ActionUtility.nav.databaseName);var n=new BBUI.webshell.Service(r,o),a=new BBUI.uimodeling.Service.fromSvc(n),i=BBUI.pages.Dialogs;t.NewPromise=function(){var e=$.Deferred();return e.resolvePromise=function(r,o){return o?e.reject(o.message):e.resolve(r)},e},t.xhr=function(e,r,o){var t=$.Deferred();return o=o||{responseFormat:"JSON"},o.successCallback=function(e){t.resolved(e)},BBUI.xhr(e,r,o),t.promise()},t.addCss=function(e){$("head").last().after("<link rel='stylesheet' href='"+e+"' type='text/css' media='screen'>")},t.addJs=function(e,r){return $.getScript(e,r)},t.findByProp=function(e,r,o){return $.grep(e,function(e){return e[r]==o})},t.findByProps=function(e,r){var o=e;return $.each(r,function(e,r){o=t.findByProp(o,r.name,r.value)}),o},t.findOneByProp=function(e,r,o){return t.findByProp(e,r,o)[0]},t.getHostParameters=function(e){var r={};return e.parameters?($.each(e.parameters,function(e,o){r[o.name]=o.value}),r):r},t.getFormValue=function(e,r){var o=e.createFormResult.formComponent.model.fields.filter(function(e){return e.name===r});return o&&o.length?o[0].value:null},t.IsValidEmailAddress=function(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)},t.UI={},t.UI.toast=function(e,r){BBUI.pages.Dialogs.notify(e,r,{position:"top-right",life:6e3})},t.UI.beginWait=function(){BBUI.forms.Utility.beginWait()},t.UI.endWait=function(){BBUI.forms.Utility.endWait()},t.UI.confirm=function(e,r,o){BBUI.forms.Utility.confirm(e,{callback:function(e){1>=e?r():o()}})},t.UI.mailTo=function(e,r,o){window.open("mailto:"+e+"?subject="+encodeURIComponent(r)+"&body="+encodeURIComponent(o))},t.UI.refreshPage=function(){e.invokePageRefresh()},t.UI.goToPage=function(r,o,t,n){e.invokePageNavigation({mode:3,destinationId:r,tabId:o,contextId:t,options:n})},t.DataForm={},t.DataForm.show=function(e,r){var o=t.NewPromise();return r=r||{},r.confirmCallback=o.resolvePromise,r.cancelCallback=o.resolvePromise,r.returnDataFormItem=!0,i.showDataForm(a,e,r),o.promise()},t.DataForm.showAddForm=function(e,r){return t.DataForm.show(e,{defaultValues:r})},t.DataForm.showEditForm=function(e,r,o){return t.DataForm.show(e,{recordId:r,defaultValues:o})},t.DataForm.load=function(e,r){var o=t.NewPromise(),a=function(e){var r={};$.each(e.values,function(){r[this.name]=this.value}),o.resolvePromise(r)};return n.dataFormLoad(e,a,o.resolvePromise,{recordId:r}),o.promise()},t.DataForm.save=function(e,r,o){var a=t.NewPromise(),i={recordId:r,values:o};return n.dataFormSave(e,a.resolvePromise,a.resolvePromise,i),a.promise()},t.DataList={},t.DataList.load=function(e,r,o){var a=t.NewPromise();return o=o||{},o.returnFormattedValues=!0,n.dataListLoad(e,r,a.resolvePromise,a.resolvePromise,o),a.promise()},t.DataList.getOutputDefinition=function(e,r){var o=t.NewPromise();return n.dataListGetOutputDefinition(e,o.resolvePromise,o.resolvePromise,r),o.promise()},t.DataList.loadAsObjects=function(e,r,o){var n=t.NewPromise();return $.when(t.DataList.load(e,r,o),t.DataList.getOutputDefinition(e)).done(function(e,r){for(var o=e.rows,t=[],a=0,i=e.rowCount;i>a;a++){for(var s={},u=0,c=r.outputFields.length;c>u;u++){var m=r.outputFields[u],l=o[a].values[u];switch(m.dataType){case 1:case 2:case 3:case 15:l=parseInt(l);break;case 5:case 6:l=parseFloat(l);break;case 7:l="True"===l}s[m.fieldId]=l}t.push(s)}n.resolvePromise(t)}),n.promise()},t.RecordOperation={},t.RecordOperation["do"]=function(e,r,o){var a=t.NewPromise();return n.recordOperationPerform(e,r,a.resolvePromise,a.resolvePromise,{parameters:o}),a.promise()},t.RecordOperation.doWithConfirm=function(e,r,o){var a=t.NewPromise();return n.recordOperationGetPrompt(e,r,function(n){t.UI.confirm(n.promptText,function(){t.RecordOperation["do"](e,r,o).then(a.resolvePromise)},a.resolvePromise)},a.resolvePromise),a.promise()}}();